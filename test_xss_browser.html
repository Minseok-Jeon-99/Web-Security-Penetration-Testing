<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XSS ì·¨ì•½ì  í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background: #1e1e1e;
            color: #d4d4d4;
        }
        .test-section {
            background: #252526;
            border: 1px solid #3c3c3c;
            border-radius: 5px;
            padding: 20px;
            margin: 20px 0;
        }
        .test-header {
            color: #4ec9b0;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .payload {
            background: #1e1e1e;
            border: 1px solid #007acc;
            padding: 10px;
            margin: 10px 0;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            color: #ce9178;
        }
        .result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 3px;
        }
        .safe {
            background: #0e4429;
            border: 1px solid #238636;
            color: #7ee787;
        }
        .vulnerable {
            background: #3c1c1c;
            border: 1px solid #f85149;
            color: #ff7b72;
        }
        button {
            background: #0e639c;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 3px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #1177bb;
        }
        #test-output {
            background: #1e1e1e;
            border: 1px solid #3c3c3c;
            padding: 15px;
            margin-top: 20px;
            min-height: 100px;
            border-radius: 5px;
        }
        .console-log {
            color: #4ec9b0;
            margin: 5px 0;
        }
        .console-warn {
            color: #dcdcaa;
            margin: 5px 0;
        }
        .console-error {
            color: #f48771;
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <h1>ğŸ”’ XSS ì·¨ì•½ì  í…ŒìŠ¤íŠ¸ ë„êµ¬</h1>
    <p>ì´ í˜ì´ì§€ëŠ” ë‹¤ì–‘í•œ XSS í˜ì´ë¡œë“œë¥¼ ì•ˆì „í•˜ê²Œ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆëŠ” í™˜ê²½ì…ë‹ˆë‹¤.</p>

    <!-- Test 1: innerHTML with script tag -->
    <div class="test-section">
        <div class="test-header">í…ŒìŠ¤íŠ¸ 1: innerHTML + &lt;script&gt; íƒœê·¸</div>
        <div class="payload">&lt;script&gt;alert('XSS')&lt;/script&gt;</div>
        <button onclick="test1()">ì‹¤í–‰</button>
        <div id="result1"></div>
        <div id="output1"></div>
    </div>

    <!-- Test 2: innerHTML with event handler -->
    <div class="test-section">
        <div class="test-header">í…ŒìŠ¤íŠ¸ 2: innerHTML + ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬</div>
        <div class="payload">&lt;img src=x onerror=alert('XSS')&gt;</div>
        <button onclick="test2()">ì‹¤í–‰</button>
        <div id="result2"></div>
        <div id="output2"></div>
    </div>

    <!-- Test 3: textContent (safe) -->
    <div class="test-section">
        <div class="test-header">í…ŒìŠ¤íŠ¸ 3: textContent (ì•ˆì „)</div>
        <div class="payload">&lt;img src=x onerror=alert('XSS')&gt;</div>
        <button onclick="test3()">ì‹¤í–‰</button>
        <div id="result3"></div>
        <div id="output3"></div>
    </div>

    <!-- Test 4: DOMPurify -->
    <div class="test-section">
        <div class="test-header">í…ŒìŠ¤íŠ¸ 4: DOMPurify ì •í™”</div>
        <div class="payload">&lt;img src=x onerror=alert('XSS')&gt;&lt;b&gt;Bold Text&lt;/b&gt;</div>
        <button onclick="test4()">ì‹¤í–‰</button>
        <div id="result4"></div>
        <div id="output4"></div>
    </div>

    <!-- Test 5: TargetApp API ì‹œë®¬ë ˆì´ì…˜ -->
    <div class="test-section">
        <div class="test-header">í…ŒìŠ¤íŠ¸ 5: ëŒ€ìƒ ì„œë¹„ìŠ¤ API ì‘ë‹µ ì‹œë®¬ë ˆì´ì…˜</div>
        <p>ì‹¤ì œ API ì‘ë‹µì²˜ëŸ¼ XSS í˜ì´ë¡œë“œë¥¼ ì²˜ë¦¬í•˜ëŠ” ë‹¤ì–‘í•œ ë°©ë²•ì„ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.</p>
        <button onclick="test5_unsafe()">âŒ ìœ„í—˜í•œ ë°©ë²• (innerHTML)</button>
        <button onclick="test5_safe()">âœ… ì•ˆì „í•œ ë°©ë²• (textContent)</button>
        <div id="result5"></div>
        <div id="output5"></div>
    </div>

    <!-- Console Output -->
    <div class="test-section">
        <div class="test-header">ğŸ“‹ ì½˜ì†” ì¶œë ¥</div>
        <div id="test-output"></div>
        <button onclick="clearConsole()">Clear</button>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.6/dist/purify.min.js"></script>
    <script>
        // Custom console for display
        const customConsole = {
            log: function(...args) {
                const msg = args.join(' ');
                document.getElementById('test-output').innerHTML +=
                    `<div class="console-log">âœ“ ${msg}</div>`;
                console.log(...args);
            },
            warn: function(...args) {
                const msg = args.join(' ');
                document.getElementById('test-output').innerHTML +=
                    `<div class="console-warn">âš  ${msg}</div>`;
                console.warn(...args);
            },
            error: function(...args) {
                const msg = args.join(' ');
                document.getElementById('test-output').innerHTML +=
                    `<div class="console-error">âœ— ${msg}</div>`;
                console.error(...args);
            }
        };

        function clearConsole() {
            document.getElementById('test-output').innerHTML = '';
        }

        // Test 1: innerHTML with script tag
        function test1() {
            const output = document.getElementById('output1');
            const result = document.getElementById('result1');

            output.innerHTML = '';

            try {
                const payload = "<script>alert('XSS from Test1')<\/script>";
                output.innerHTML = payload;

                customConsole.log('Test 1: script íƒœê·¸ ì‚½ì… ì™„ë£Œ');
                customConsole.log('innerHTMLì— script íƒœê·¸ëŠ” ì‹¤í–‰ë˜ì§€ ì•ŠìŒ!');
                result.innerHTML = '<div class="result safe">âœ“ ì•ˆì „ - script íƒœê·¸ëŠ” innerHTMLë¡œ ì‚½ì… ì‹œ ì‹¤í–‰ ì•ˆ ë¨</div>';
            } catch(e) {
                customConsole.error('Test 1 Error:', e.message);
                result.innerHTML = '<div class="result safe">âœ“ ì—ëŸ¬ ë°œìƒìœ¼ë¡œ ì•ˆì „</div>';
            }
        }

        // Test 2: innerHTML with event handler
        function test2() {
            const output = document.getElementById('output2');
            const result = document.getElementById('result2');

            output.innerHTML = '';

            // Alert ëŒ€ì‹  console.log ì‚¬ìš© (í…ŒìŠ¤íŠ¸ í¸ì˜)
            const payload = "<img src=x onerror=\"customConsole.warn('XSS ì‹¤í–‰ë¨! ì·¨ì•½í•©ë‹ˆë‹¤.')\">";
            output.innerHTML = payload;

            customConsole.log('Test 2: ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ì‚½ì… ì™„ë£Œ');
            result.innerHTML = '<div class="result vulnerable">âš  ì·¨ì•½ - ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ê°€ ì‹¤í–‰ë¨!</div>';
        }

        // Test 3: textContent (safe)
        function test3() {
            const output = document.getElementById('output3');
            const result = document.getElementById('result3');

            output.innerHTML = '';

            const payload = "<img src=x onerror=alert('XSS')>";
            output.textContent = payload;

            customConsole.log('Test 3: textContent ì‚¬ìš©');
            customConsole.log('ê²°ê³¼:', output.textContent);
            result.innerHTML = '<div class="result safe">âœ“ ì•ˆì „ - HTMLì´ í…ìŠ¤íŠ¸ë¡œ í‘œì‹œë¨</div>';
        }

        // Test 4: DOMPurify
        function test4() {
            const output = document.getElementById('output4');
            const result = document.getElementById('result4');

            output.innerHTML = '';

            const dirty = "<img src=x onerror=alert('XSS')><b>Bold Text</b>";
            const clean = DOMPurify.sanitize(dirty);

            customConsole.log('Test 4: DOMPurify ì •í™”');
            customConsole.log('ì›ë³¸:', dirty);
            customConsole.log('ì •í™”ë¨:', clean);

            output.innerHTML = clean;
            result.innerHTML = '<div class="result safe">âœ“ ì•ˆì „ - ì•…ì„± ì½”ë“œëŠ” ì œê±°ë˜ê³  ì•ˆì „í•œ HTMLë§Œ ìœ ì§€</div>';
        }

        // Test 5: TargetApp API simulation
        function test5_unsafe() {
            const output = document.getElementById('output5');
            const result = document.getElementById('result5');

            output.innerHTML = '';

            // ì‹¤ì œ ëŒ€ìƒ ì„œë¹„ìŠ¤ API ì‘ë‹µ ì‹œë®¬ë ˆì´ì…˜
            const apiResponse = {
                request_data: {
                    query_string: "<img src=x onerror=\"customConsole.warn('ëŒ€ìƒ ì„œë¹„ìŠ¤ XSS ì·¨ì•½ì  ë°œê²¬!')\">"
                }
            };

            // âŒ ìœ„í—˜í•œ ë°©ë²•
            output.innerHTML = `ê²€ìƒ‰ì–´: ${apiResponse.request_data.query_string}`;

            customConsole.warn('ìœ„í—˜í•œ ë°©ë²•: innerHTML ì‚¬ìš©');
            result.innerHTML = '<div class="result vulnerable">âš  ì·¨ì•½ - í”„ë¡ íŠ¸ì—”ë“œì—ì„œ innerHTML ì‚¬ìš© ì‹œ XSS ë°œìƒ!</div>';
        }

        function test5_safe() {
            const output = document.getElementById('output5');
            const result = document.getElementById('result5');

            output.innerHTML = '';

            // ì‹¤ì œ ëŒ€ìƒ ì„œë¹„ìŠ¤ API ì‘ë‹µ ì‹œë®¬ë ˆì´ì…˜
            const apiResponse = {
                request_data: {
                    query_string: "<img src=x onerror=alert('XSS')>"
                }
            };

            // âœ… ì•ˆì „í•œ ë°©ë²•
            const p = document.createElement('p');
            p.textContent = `ê²€ìƒ‰ì–´: ${apiResponse.request_data.query_string}`;
            output.appendChild(p);

            customConsole.log('ì•ˆì „í•œ ë°©ë²•: textContent ì‚¬ìš©');
            customConsole.log('í‘œì‹œëœ ë‚´ìš©:', p.textContent);
            result.innerHTML = '<div class="result safe">âœ“ ì•ˆì „ - textContent ì‚¬ìš©ìœ¼ë¡œ XSS ì°¨ë‹¨</div>';
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì•ˆë‚´
        window.onload = function() {
            customConsole.log('=== XSS í…ŒìŠ¤íŠ¸ í™˜ê²½ ì¤€ë¹„ ì™„ë£Œ ===');
            customConsole.log('ê° í…ŒìŠ¤íŠ¸ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ XSS ë™ì‘ì„ í™•ì¸í•˜ì„¸ìš”.');
            customConsole.log('');
        };
    </script>
</body>
</html>
